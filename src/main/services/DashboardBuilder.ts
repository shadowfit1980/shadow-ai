/**
 * ðŸ“Š DashboardBuilder
 * 
 * Analytics dashboards:
 * - Charts, widgets, real-time data
 */

import { EventEmitter } from 'events';

export class DashboardBuilder extends EventEmitter {
    private static instance: DashboardBuilder;

    private constructor() { super(); }

    static getInstance(): DashboardBuilder {
        if (!DashboardBuilder.instance) {
            DashboardBuilder.instance = new DashboardBuilder();
        }
        return DashboardBuilder.instance;
    }

    generate(): string {
        return `// Dashboard Builder
// Generated by Shadow AI

/**
 * DASHBOARD BUILDER
 * 
 * Build analytics dashboards with charts and widgets.
 */

// === Chart Components ===
class ChartLibrary {
    generateLineChart(): string {
        return \`
import { Line } from 'react-chartjs-2';
import { Chart, registerables } from 'chart.js';

Chart.register(...registerables);

export function LineChart({ data, options }: { data: ChartData; options?: ChartOptions }) {
    return (
        <Line
            data={data}
            options={{
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true }
                },
                ...options
            }}
        />
    );
}
        \`;
    }
    
    generateBarChart(): string {
        return \`
export function BarChart({ data, horizontal = false }: { data: ChartData; horizontal?: boolean }) {
    return (
        <Bar
            data={data}
            options={{
                indexAxis: horizontal ? 'y' : 'x',
                responsive: true,
                plugins: {
                    legend: { display: false }
                }
            }}
        />
    );
}
        \`;
    }
}

// === Dashboard Layout ===
class DashboardLayout {
    generateDashboard(): string {
        return \`
import { Responsive, WidthProvider } from 'react-grid-layout';

const ResponsiveGridLayout = WidthProvider(Responsive);

interface Widget {
    id: string;
    type: 'chart' | 'metric' | 'table' | 'custom';
    title: string;
    config: any;
    layout: { x: number; y: number; w: number; h: number };
}

export function Dashboard({ widgets, onLayoutChange }: { widgets: Widget[]; onLayoutChange?: (layout: any) => void }) {
    const layouts = {
        lg: widgets.map(w => ({ i: w.id, ...w.layout }))
    };
    
    return (
        <ResponsiveGridLayout
            className="dashboard-layout"
            layouts={layouts}
            breakpoints={{ lg: 1200, md: 996, sm: 768, xs: 480, xxs: 0 }}
            cols={{ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }}
            rowHeight={100}
            onLayoutChange={onLayoutChange}
            draggableHandle=".widget-header"
        >
            {widgets.map(widget => (
                <div key={widget.id} className="widget">
                    <div className="widget-header">
                        <h3>{widget.title}</h3>
                        <WidgetMenu widget={widget} />
                    </div>
                    <div className="widget-content">
                        <WidgetRenderer widget={widget} />
                    </div>
                </div>
            ))}
        </ResponsiveGridLayout>
    );
}
        \`;
    }
}

// === Metric Cards ===
class MetricCards {
    generateMetricCard(): string {
        return \`
interface MetricCardProps {
    title: string;
    value: number | string;
    change?: number;
    changeLabel?: string;
    icon?: React.ReactNode;
    color?: 'default' | 'success' | 'warning' | 'danger';
}

export function MetricCard({ title, value, change, changeLabel, icon, color = 'default' }: MetricCardProps) {
    const isPositive = change && change > 0;
    const isNegative = change && change < 0;
    
    return (
        <div className={\\\`metric-card metric-card--\\\${color}\\\`}>
            <div className="metric-header">
                <span className="metric-title">{title}</span>
                {icon && <span className="metric-icon">{icon}</span>}
            </div>
            <div className="metric-value">{value}</div>
            {change !== undefined && (
                <div className={\\\`metric-change \\\${isPositive ? 'positive' : ''} \\\${isNegative ? 'negative' : ''}\\\`}>
                    <span>{isPositive ? 'â†‘' : isNegative ? 'â†“' : 'â†’'}</span>
                    <span>{Math.abs(change)}%</span>
                    {changeLabel && <span className="change-label">{changeLabel}</span>}
                </div>
            )}
        </div>
    );
}
        \`;
    }
}

export { ChartLibrary, DashboardLayout, MetricCards };
`;
    }
}

export const dashboardBuilder = DashboardBuilder.getInstance();
