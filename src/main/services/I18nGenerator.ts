/**
 * üåç I18n Generator
 * 
 * Generate internationalization:
 * - Translations, RTL, plurals
 */

import { EventEmitter } from 'events';

export class I18nGenerator extends EventEmitter {
    private static instance: I18nGenerator;

    private constructor() { super(); }

    static getInstance(): I18nGenerator {
        if (!I18nGenerator.instance) {
            I18nGenerator.instance = new I18nGenerator();
        }
        return I18nGenerator.instance;
    }

    generateReactI18n(): string {
        return `// React i18n Setup (react-i18next)
// Generated by Shadow AI

import i18n from 'i18next';
import { initReactI18next, useTranslation, Trans } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import Backend from 'i18next-http-backend';

// Initialize i18n
i18n
    .use(Backend)
    .use(LanguageDetector)
    .use(initReactI18next)
    .init({
        fallbackLng: 'en',
        supportedLngs: ['en', 'es', 'fr', 'de', 'ar', 'zh', 'ja'],
        debug: process.env.NODE_ENV === 'development',
        
        interpolation: {
            escapeValue: false
        },
        
        backend: {
            loadPath: '/locales/{{lng}}/{{ns}}.json'
        },
        
        detection: {
            order: ['querystring', 'cookie', 'localStorage', 'navigator'],
            caches: ['localStorage', 'cookie']
        },
        
        react: {
            useSuspense: true
        }
    });

export default i18n;

// Translation files structure
// /locales/en/common.json
const enCommon = {
    "nav": {
        "home": "Home",
        "about": "About",
        "contact": "Contact"
    },
    "auth": {
        "login": "Log In",
        "logout": "Log Out",
        "signup": "Sign Up",
        "email": "Email",
        "password": "Password",
        "forgotPassword": "Forgot Password?",
        "rememberMe": "Remember Me"
    },
    "common": {
        "loading": "Loading...",
        "error": "An error occurred",
        "retry": "Retry",
        "save": "Save",
        "cancel": "Cancel",
        "delete": "Delete",
        "edit": "Edit",
        "search": "Search",
        "noResults": "No results found"
    },
    "plurals": {
        "item": "{{count}} item",
        "item_plural": "{{count}} items",
        "day": "{{count}} day",
        "day_plural": "{{count}} days"
    },
    "formats": {
        "date": "{{date, date(format: medium)}}",
        "currency": "{{amount, currency(USD)}}"
    }
};

// /locales/es/common.json
const esCommon = {
    "nav": {
        "home": "Inicio",
        "about": "Acerca de",
        "contact": "Contacto"
    },
    "auth": {
        "login": "Iniciar Sesi√≥n",
        "logout": "Cerrar Sesi√≥n",
        "signup": "Registrarse",
        "email": "Correo Electr√≥nico",
        "password": "Contrase√±a",
        "forgotPassword": "¬øOlvidaste tu contrase√±a?",
        "rememberMe": "Recu√©rdame"
    }
};

// /locales/ar/common.json (RTL)
const arCommon = {
    "nav": {
        "home": "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
        "about": "ÿ≠ŸàŸÑ",
        "contact": "ÿßÿ™ÿµŸÑ ÿ®ŸÜÿß"
    }
};

// Usage in components
function Component() {
    const { t, i18n } = useTranslation();
    
    return (
        <div dir={i18n.dir()}>
            <h1>{t('nav.home')}</h1>
            
            {/* With interpolation */}
            <p>{t('welcome', { name: 'John' })}</p>
            
            {/* Plurals */}
            <span>{t('plurals.item', { count: 5 })}</span>
            
            {/* Trans component for rich text */}
            <Trans i18nKey="richText">
                Hello <strong>World</strong>
            </Trans>
            
            {/* Language switcher */}
            <select 
                value={i18n.language} 
                onChange={(e) => i18n.changeLanguage(e.target.value)}
            >
                <option value="en">English</option>
                <option value="es">Espa√±ol</option>
                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            </select>
        </div>
    );
}

// RTL Support Hook
function useDirection() {
    const { i18n } = useTranslation();
    const rtlLanguages = ['ar', 'he', 'fa', 'ur'];
    const isRTL = rtlLanguages.includes(i18n.language);
    
    useEffect(() => {
        document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
        document.documentElement.lang = i18n.language;
    }, [i18n.language, isRTL]);
    
    return { isRTL, dir: isRTL ? 'rtl' : 'ltr' };
}

// Date/Number formatting
function useFormatters() {
    const { i18n } = useTranslation();
    
    const formatDate = (date: Date, options?: Intl.DateTimeFormatOptions) => {
        return new Intl.DateTimeFormat(i18n.language, {
            dateStyle: 'medium',
            ...options
        }).format(date);
    };
    
    const formatNumber = (num: number, options?: Intl.NumberFormatOptions) => {
        return new Intl.NumberFormat(i18n.language, options).format(num);
    };
    
    const formatCurrency = (amount: number, currency = 'USD') => {
        return new Intl.NumberFormat(i18n.language, {
            style: 'currency',
            currency
        }).format(amount);
    };
    
    const formatRelativeTime = (date: Date) => {
        const rtf = new Intl.RelativeTimeFormat(i18n.language, { numeric: 'auto' });
        const diff = date.getTime() - Date.now();
        const days = Math.round(diff / (1000 * 60 * 60 * 24));
        
        if (Math.abs(days) < 1) {
            const hours = Math.round(diff / (1000 * 60 * 60));
            return rtf.format(hours, 'hour');
        }
        return rtf.format(days, 'day');
    };
    
    return { formatDate, formatNumber, formatCurrency, formatRelativeTime };
}

export { useDirection, useFormatters };
`;
    }

    generateNextI18n(): string {
        return `// Next.js i18n (next-intl)
// Generated by Shadow AI

// next.config.js
const nextConfig = {
    i18n: {
        locales: ['en', 'es', 'fr', 'de', 'ar'],
        defaultLocale: 'en',
        localeDetection: true
    }
};

// middleware.ts
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
    locales: ['en', 'es', 'fr', 'de', 'ar'],
    defaultLocale: 'en'
});

export const config = {
    matcher: ['/((?!api|_next|.*\\..*).*)']
};

// messages/en.json
const messages = {
    "Index": {
        "title": "Welcome to Next.js",
        "description": "Get started by editing {file}"
    }
};

// app/[locale]/layout.tsx
import { NextIntlClientProvider, useMessages } from 'next-intl';

export default function LocaleLayout({ children, params: { locale } }) {
    const messages = useMessages();
    
    return (
        <html lang={locale} dir={locale === 'ar' ? 'rtl' : 'ltr'}>
            <body>
                <NextIntlClientProvider locale={locale} messages={messages}>
                    {children}
                </NextIntlClientProvider>
            </body>
        </html>
    );
}

// app/[locale]/page.tsx
import { useTranslations } from 'next-intl';

export default function Page() {
    const t = useTranslations('Index');
    
    return (
        <div>
            <h1>{t('title')}</h1>
            <p>{t('description', { file: 'page.tsx' })}</p>
        </div>
    );
}
`;
    }
}

export const i18nGenerator = I18nGenerator.getInstance();
