/**
 * üêö ShellScriptingService
 * 
 * Bash/PowerShell/Zsh generation:
 * - Cross-platform scripts
 */

import { EventEmitter } from 'events';

export class ShellScriptingService extends EventEmitter {
    private static instance: ShellScriptingService;
    private constructor() { super(); }
    static getInstance(): ShellScriptingService {
        if (!ShellScriptingService.instance) {
            ShellScriptingService.instance = new ShellScriptingService();
        }
        return ShellScriptingService.instance;
    }

    generate(): string {
        return `// Shell Scripting Service - Bash/PowerShell generation
// Generated by Shadow AI

class ShellScripting {
    // Generate bash script
    async generateBash(task: string): Promise<ShellScript> {
        const response = await llm.chat([{
            role: 'system',
            content: \`Generate a production-ready bash script.
            Include:
            - Shebang and set options (errexit, nounset, pipefail)
            - Argument parsing
            - Error handling
            - Logging
            - Cleanup traps
            - Help message\`
        }, {
            role: 'user',
            content: task
        }]);
        
        return {
            shell: 'bash',
            script: response.content,
            filename: 'script.sh'
        };
    }
    
    // Generate PowerShell script
    async generatePowerShell(task: string): Promise<ShellScript> {
        const response = await llm.chat([{
            role: 'system',
            content: \`Generate a production-ready PowerShell script.
            Include:
            - param block
            - Error handling (try/catch)
            - Verbose output
            - Comment-based help
            - CmdletBinding\`
        }, {
            role: 'user',
            content: task
        }]);
        
        return {
            shell: 'powershell',
            script: response.content,
            filename: 'script.ps1'
        };
    }
    
    // Generate cross-platform script
    async generateCrossPlatform(task: string): Promise<CrossPlatformScript> {
        const bash = await this.generateBash(task);
        const powershell = await this.generatePowerShell(task);
        
        // Generate a wrapper that detects OS
        const wrapper = \`#!/bin/bash
# Cross-platform wrapper
if [[ "\$OSTYPE" == "msys" ]] || [[ "\$OSTYPE" == "win32" ]]; then
    powershell.exe -File script.ps1 "\$@"
else
    ./script.sh "\$@"
fi\`;
        
        return {
            bash: bash.script,
            powershell: powershell.script,
            wrapper
        };
    }
    
    // Generate Makefile
    async generateMakefile(project: string): Promise<string> {
        const response = await llm.chat([{
            role: 'system',
            content: \`Generate a Makefile for this project.
            Include common targets: build, test, clean, install, dev, lint, format.\`
        }, {
            role: 'user',
            content: project
        }]);
        
        return response.content;
    }
    
    // Generate Docker commands
    async generateDockerCommands(scenario: string): Promise<string> {
        const response = await llm.chat([{
            role: 'system',
            content: 'Generate Docker CLI commands for this scenario.'
        }, {
            role: 'user',
            content: scenario
        }]);
        
        return response.content;
    }
    
    // Explain shell command
    async explainCommand(command: string): Promise<string> {
        const response = await llm.chat([{
            role: 'system',
            content: 'Explain this shell command in detail, breaking down each part and flag.'
        }, {
            role: 'user',
            content: command
        }]);
        
        return response.content;
    }
    
    // Convert between shells
    async convertShell(script: string, from: 'bash' | 'zsh' | 'fish', to: 'bash' | 'powershell'): Promise<string> {
        const response = await llm.chat([{
            role: 'system',
            content: \`Convert this \${from} script to \${to}.\`
        }, {
            role: 'user',
            content: script
        }]);
        
        return response.content;
    }
}

export { ShellScripting };
`;
    }
}

export const shellScriptingService = ShellScriptingService.getInstance();
