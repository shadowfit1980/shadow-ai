/**
 * ðŸŽ¨ ThemeGenerator
 * 
 * Theme system:
 * - Dark/light, custom themes, persistence
 */

import { EventEmitter } from 'events';

export class ThemeGenerator extends EventEmitter {
    private static instance: ThemeGenerator;
    private constructor() { super(); }
    static getInstance(): ThemeGenerator {
        if (!ThemeGenerator.instance) {
            ThemeGenerator.instance = new ThemeGenerator();
        }
        return ThemeGenerator.instance;
    }

    generate(): string {
        return `// Theme Generator - Dark/light, custom themes, persistence
// Generated by Shadow AI

// Theme Context
const ThemeContext = createContext<{
    theme: 'light' | 'dark' | 'system';
    setTheme: (theme: 'light' | 'dark' | 'system') => void;
    resolvedTheme: 'light' | 'dark';
}>({
    theme: 'system',
    setTheme: () => {},
    resolvedTheme: 'light'
});

export function ThemeProvider({ children }: { children: React.ReactNode }) {
    const [theme, setTheme] = useState<'light' | 'dark' | 'system'>('system');
    const [resolvedTheme, setResolvedTheme] = useState<'light' | 'dark'>('light');
    
    useEffect(() => {
        const stored = localStorage.getItem('theme') as 'light' | 'dark' | 'system' | null;
        if (stored) setTheme(stored);
    }, []);
    
    useEffect(() => {
        localStorage.setItem('theme', theme);
        
        if (theme === 'system') {
            const media = window.matchMedia('(prefers-color-scheme: dark)');
            setResolvedTheme(media.matches ? 'dark' : 'light');
            
            const handler = (e: MediaQueryListEvent) => setResolvedTheme(e.matches ? 'dark' : 'light');
            media.addEventListener('change', handler);
            return () => media.removeEventListener('change', handler);
        } else {
            setResolvedTheme(theme);
        }
    }, [theme]);
    
    useEffect(() => {
        document.documentElement.classList.remove('light', 'dark');
        document.documentElement.classList.add(resolvedTheme);
    }, [resolvedTheme]);
    
    return (
        <ThemeContext.Provider value={{ theme, setTheme, resolvedTheme }}>
            {children}
        </ThemeContext.Provider>
    );
}

export function useTheme() {
    return useContext(ThemeContext);
}

// Theme Toggle Component
export function ThemeToggle() {
    const { theme, setTheme } = useTheme();
    
    return (
        <select value={theme} onChange={(e) => setTheme(e.target.value as any)}>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="system">System</option>
        </select>
    );
}

// CSS Variables Theme
const lightTheme = {
    '--background': '#ffffff',
    '--foreground': '#000000',
    '--primary': '#3b82f6',
    '--secondary': '#6b7280',
    '--accent': '#8b5cf6'
};

const darkTheme = {
    '--background': '#0a0a0a',
    '--foreground': '#ffffff',
    '--primary': '#60a5fa',
    '--secondary': '#9ca3af',
    '--accent': '#a78bfa'
};
`;
    }
}

export const themeGenerator = ThemeGenerator.getInstance();
